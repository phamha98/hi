<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Electron VPS Connect</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h1 {
            color: #333;
        }

        input,
        button {
            padding: 10px;
            font-size: 16px;
            margin: 5px 0;
            width: 100%;
        }

        pre {
            background: #f4f4f4;
            padding: 10px;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <!-- <h1>Electron VPS Connection</h1> -->
    <input type="text" id="vps-url" placeholder="URL" value="176.32.66.38" />
    <button id="fetch-data">Connect</button>
    <button id="import-pem">file</button>
    <pre id="response">----</pre>
    <button id="back-button">back-button</button>
    <button id="pwd">-</button>
    <div id="file-list">
    </div>
    <script>
        const fetchButton = document.getElementById('fetch-data');
        const importPemButton = document.getElementById('import-pem');
        const vpsUrlInput = document.getElementById('vps-url');
        const responseDisplay = document.getElementById('response');
        const pwd = document.getElementById('pwd');

        let pemFilePath = null;  // Bi·∫øn l∆∞u ƒë∆∞·ªùng d·∫´n file PEM

        // L·∫Øng nghe s·ª± ki·ªán nh·∫•n n√∫t "Import PEM File"
        importPemButton.addEventListener('click', async () => {
            pemFilePath = await window.electronAPI.selectPemFile();  // M·ªü h·ªôp tho·∫°i ch·ªçn file PEM
            if (pemFilePath) {
                importPemButton.textContent = 'PEM file selected: ' + pemFilePath.split('/').pop()
                importPemButton.style.color = "blue"
                // alert('PEM file selected: ' + pemFilePath);
            } else {
                importPemButton.textContent = 'No PEM file selected'
                importPemButton.style.color = "gray"
                // alert('No PEM file selected');
            }
        });

        // L·∫Øng nghe s·ª± ki·ªán nh·∫•n n√∫t "Fetch Data"
        fetchButton.addEventListener('click', async () => {
            console.log('click')
            responseDisplay.textContent = 'click'
            // const url = vpsUrlInput.value;
            // if (!url) {
            //     alert('Please enter a valid URL!');
            //     return;
            // }
            // if (!pemFilePath) {
            //     // alert('Please select a PEM file!');
            //     // return;
            // }

            window.electronAPI.send('start-ssh-stream', {
                host: '176.32.66.38',
                pem: 'stalk-key-ED25519.pem',
                port: 22,
                pemFilePath: pemFilePath,
                username: 'ubuntu'
            });


        });
        window.electronAPI.receive('ssh-state', ({ data }) => { responseDisplay.textContent = data })
        // Nh·∫≠n d·ªØ li·ªáu t·ª´ Electron API
        // L∆∞u tr·ªØ tr·∫°ng th√°i c√°c th∆∞ m·ª•c ƒë√£ duy·ªát v√† d·ªØ li·ªáu t·∫£i v·ªÅ
        let folders = [];
        let currentFolderPath = '/'; // B·∫Øt ƒë·∫ßu ·ªü th∆∞ m·ª•c g·ªëc
        window.electronAPI.receive('ssh-pwd', ({ data }) => {
            console.log('receive ssh-pwd', data)
            folders = data.split('/').filter(i => i != '')
            console.log('receive folders', folders)
            pwd.textContent = folders.join('/')
        })
        window.electronAPI.receive('ssh-data', ({ data }) => {
            console.log('onResponse ssh-data', data);

            // L·∫•y ph·∫ßn t·ª≠ ul n∆°i b·∫°n mu·ªën hi·ªÉn th·ªã d·ªØ li·ªáu
            const fileListContainer = document.getElementById('file-list');
            fileListContainer.innerHTML = ''; // Clear any previous content

            // Ki·ªÉm tra n·∫øu data l√† m·∫£ng v√† c√≥ d·ªØ li·ªáu
            if (Array.isArray(data) && data.length > 0) {
                // T·∫°o m·ªôt th·∫ª <ul> m·ªõi
                const ul = document.createElement('ul');
                fileListContainer.appendChild(ul); // Th√™m <ul> v√†o container

                // L·∫∑p qua t·ª´ng t·ªáp/th∆∞ m·ª•c v√† hi·ªÉn th·ªã
                data.forEach(item => {
                    const li = document.createElement('li'); // T·∫°o th·∫ª <li> cho m·ªói t·ªáp/th∆∞ m·ª•c

                    // Th√™m l·ªõp CSS cho <li> ƒë·ªÉ l√†m button
                    li.classList.add('file-item');
                    li.style.cursor = 'pointer'; // Th√™m ki·ªÉu con tr·ªè khi hover

                    // Th√™m bi·ªÉu t∆∞·ª£ng v√†o li (s·ª≠ d·ª•ng FontAwesome ho·∫∑c b·∫•t k·ª≥ icon n√†o b·∫°n th√≠ch)
                    const icon = document.createElement('span');
                    icon.classList.add('file-icon');

                    // Th√™m icon t∆∞∆°ng ·ª©ng v·ªõi th∆∞ m·ª•c ho·∫∑c t·ªáp
                    if (item.permissions[0] === 'd') {
                        icon.textContent = 'üìÅ'; // Bi·ªÉu t∆∞·ª£ng th∆∞ m·ª•c
                    } else {
                        icon.textContent = 'üìÑ'; // Bi·ªÉu t∆∞·ª£ng t·ªáp
                    }

                    // Th√™m icon v√†o <li>
                    li.appendChild(icon);

                    // Th√™m t√™n t·ªáp/th∆∞ m·ª•c v√†o <li>
                    const text = document.createElement('span');
                    text.textContent = ` ${item.name}`;
                    li.appendChild(text);

                    // X·ª≠ l√Ω s·ª± ki·ªán click
                    li.addEventListener('click', () => {
                        console.log(`Clicked on: ${item.name}`);
                        if (item.name == ".") return
                        else if (item.name == "..") {
                            folders.pop()
                            const current = folders.join('/')
                            console.log('current', current)
                            pwd.textContent = current
                            window.electronAPI.send('read-folder', { folderPath: '/' + current });

                        }
                        else if (item.permissions[0] === 'd') {
                            // N·∫øu l√† th∆∞ m·ª•c, l∆∞u l·∫°i th∆∞ m·ª•c hi·ªán t·∫°i v√† g·ªçi 'read-folder'
                            // pwd.textContent = currentFolderPath
                            console.log('click 1', folders)
                            folders.push(item.name)
                            const current = folders.join('/')
                            pwd.textContent = current
                            console.log('click 2', folders)
                            window.electronAPI.send('read-folder', { folderPath: '/' + current });
                        } else {
                            // N·∫øu l√† t·ªáp, g·ª≠i s·ª± ki·ªán 'read-file'
                            window.electronAPI.send('read-file', { filePath: item.name });
                        }
                    });

                    // Th√™m <li> v√†o <ul>
                    ul.appendChild(li);
                });
            } else {
                fileListContainer.textContent = 'No files or directories found.';
            }
        });

        // X·ª≠ l√Ω n√∫t Back
        const backButton = document.getElementById('back-button');
        backButton.addEventListener('click', () => {
            if (folders.length > 0) {
                folders.pop()
                const current = folders.join('/')
                console.log('current', current)
                pwd.textContent = current
                window.electronAPI.send('read-folder', { folderPath: '/' + current });
            }
        });


    </script>
</body>

</html>